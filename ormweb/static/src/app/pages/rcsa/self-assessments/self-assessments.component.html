<mat-toolbar class="fontSize">
    <button mat-raised-button color="primary"
        style="display:inline-block; padding:0vh 1vh;border-radius:100vw;margin-right: 10px;"
        (click)="navigateToPreviousPage()" matTooltip="Navigate back to RCSA Summary">
        <span style="font-size:16px; margin-right:10px;">&#11164;</span>Back
    </button>
    <span>Self Assessment Summary</span>
    <span class="spacer"></span>
</mat-toolbar>
<div class="container">
    <mat-action-row style="padding-bottom: 0px;padding-right: 24px ;padding-top: 20px;">
        <span class="spacer"></span>
        <div class="assesment-button">

            <!-- NEW: Create Ad Hoc Risk button (visible only when RCSA Status is 'In-Progress') -->
            <div class="applyFilter addDesktop position-relative text-start me-4">
                <button mat-raised-button class="adHocRiskBtn" color="accent"
                    *ngIf="canShowAdHocRiskbtn"
                    (click)="createAdHocRisk()">
                    <img src="./assets/images/icon-add-desktop.svg" alt="" class="plusIcon">
                    Create Ad Hoc Risk
                </button>
            </div>
            <!-- <button mat-raised-button class="adHocRiskBtn" color="accent"
                *ngIf="rcsaSelfAssessmentHeader?.Status === 'In-Progress' && scheduleAssessmentID != null && UnitNames"
                (click)="createAdHocRisk()" style="height: 5vh; margin-left:8px;">
                <img src="./assets/images/icon-add-desktop.svg" alt="" style="width:18px; margin-right:6px;">
                Create Ad Hoc Risk
            </button> -->

            <button mat-raised-button class="submitassessment" color="primary" (click)="submitScheduleAssessment()"
                *ngIf="scheduleAssessmentID != null && isShowSubmitbtn && UnitNames"
                [disabled]="!(canSubmitAccess() && canSubmitByActionPlan() && canSubmitByStatus())"
                style="height: 5vh;">
                <img src="./assets/images/icon-send.svg" alt="">
                Submit
            </button>


            <span class="spacer"></span>
            <mat-form-field appearance="fill" style="margin-right: 15px;">
                <mat-label>Search</mat-label>
                <input matInput placeholder="Eg. high risk" #input (keyup)="applyFilter($event)">
            </mat-form-field>
            <span [ngClass]="showexportData ? 'showExcel' : 'hideExcel' " (click)="exportAsXLSX()"
                class="mat-button-wrapper" matTooltip="Export to Excel"><img src="assets/icon-excel.svg"
                    style="opacity:Â 1;"></span>
        </div>
    </mat-action-row>
    <mat-action-row style="padding: 0px;border: 0px;">
        <div fxLayout="row wrap" fxLayoutAlign="center stretch">
            <div fxLayout="row wrap" fxLayoutGap="10px grid" fxFlex="15" fxFlexOffset="3"
                fxLayoutAlign="center stretch">
                <mat-card class="mat-elevation-z4 ScheduleGroup" fxFlex.lg="98" fxFlex.md="98" fxFlex.sm="100"
                    fxFlexOffset.md="1">
                    <mat-card-header>
                    </mat-card-header>
                    <mat-card-content>
                        <div fxLayout="column" class="AssessmentCard" fxFlexAlign="start center">
                            <div fxLayout="row" class="SubAssessmentCard" fxLayoutAlign="center center"
                                *ngFor="let data of dataSourceAssessmentCard;let i = index">
                                <div class="LeftSideWidget" fxLayout="column" fxFlex="100" fxLayoutAlign="center center"
                                    (click)="getStatusFilter(data.ScheduleInherentRiskStatusID,i)"
                                    [ngClass]="i == indexData ? 'active' : 'inactive'">
                                    <span class="TextboxSpan">
                                        <b> {{data.TotalValue}}</b>
                                    </span>
                                    <span class="TextboxSpan">
                                        <b> {{data.ScheduleInherentRiskStatusName}}</b>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </mat-card-content>
                    <mat-card-actions>
                    </mat-card-actions>
                </mat-card>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="10px grid" fxFlex="83" fxLayoutAlign="center start">
                <mat-card class="mat-elevation-z4 customDetailCard" fxFlex="98" fxFlex.md="98" fxFlex.sm="100"
                    fxFlexOffset.lg="1" fxFlexOffset.md="1" style="padding: 0px;">
                    <mat-card-content>
                        <div class="container" fxLayout="row" fxFlexAlign="space-evenly center"
                            style="background-color: #e5e5e5 !important;">
                            <div class="Proposeddateinfo" fxLayout="column" fxFlex="33">
                                <div class="d-flex" style="margin-bottom: 7px;">
                                    <b>RCSA Code:</b>&nbsp;<span>{{rcsaSelfAssessmentHeader?.RCSACode }}</span>
                                </div>
                                <div class="d-flex">
                                    <b>Period:</b> &nbsp; <span>{{rcsaSelfAssessmentHeader?.Period}}</span>
                                </div>
                            </div>
                            <div class="Proposeddateinfo" fxLayout="column" fxFlex="33">
                                <div class="d-flex" style="margin-bottom: 7px;">
                                    <b>Proposed Start Date:</b> &nbsp;
                                    <span>{{(rcsaSelfAssessmentHeader?.ProposedStartDate != null )?
                                        (rcsaSelfAssessmentHeader.ProposedStartDate | date:'dd MMM yyyy'):" - "}}</span>
                                </div>
                                <div class="d-flex">
                                    <b>Proposed End Date:</b> &nbsp;
                                    <span>
                                        {{(rcsaSelfAssessmentHeader?.ProposedCompletionDate != null) ?
                                        (rcsaSelfAssessmentHeader.ProposedCompletionDate |
                                        date:'dd MMM yyyy'):" -"}}
                                    </span>
                                </div>
                            </div>
                            <div class="Proposeddateinfo" fxLayout="column" fxFlex="33">
                                <div class="d-flex" style="margin-bottom: 7px;">
                                    <b>Status:</b> &nbsp;
                                    <span>
                                        {{this.SelfAssessmentSummaryList.length ? rcsaSelfAssessmentHeader?.Status :
                                        ''}}
                                    </span>
                                </div>
                                <div class="d-flex">
                                    <b>Total Approved Percentage:</b> &nbsp;
                                    <span>
                                        {{(this.SelfAssessmentSummaryList.length == 0 &&
                                        rcsaSelfAssessmentHeader?.TotalPercentage == 0) ? " ":
                                        rcsaSelfAssessmentHeader?.TotalPercentage+' %'}}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>
                <mat-card class="mat-elevation-z4" fxFlex="98" fxFlex.md="98" fxFlex.sm="100" fxFlexOffset.lg="1"
                    fxFlexOffset.md="1">
                    <mat-card-header>
                    </mat-card-header>
                    <mat-card-content class="tablecontent">
                        <table id="SelfAssesssmentTable" mat-table [dataSource]="dataSource" matSort
                            multiTemplateDataRows>
                            <ng-container matColumnDef="SLNo">
                                <th mat-header-cell *matHeaderCellDef>SL #</th>
                                <td mat-cell *matCellDef="let row" [matTooltip]="getTooltip(row,'SLNO')">{{row.SLNO}}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="Group">
                                <th mat-header-cell *matHeaderCellDef [hidden]="showRiskStatus">Department</th>
                                <td mat-cell *matCellDef="let row" [matTooltip]="getTooltip(row,'GroupName')"
                                    [hidden]="showRiskStatus">
                                    {{row.GroupName}}</td>
                            </ng-container>
                            <ng-container matColumnDef="Unit">
                                <th mat-header-cell *matHeaderCellDef [hidden]="showRiskStatus">Unit</th>
                                <td mat-cell *matCellDef="let row" [matTooltip]="getTooltip(row,'UnitName')"
                                    [hidden]="showRiskStatus">
                                    {{row.UnitName}}</td>
                            </ng-container>
                            <ng-container matColumnDef="Risk">
                                <th mat-header-cell *matHeaderCellDef>Risk</th>
                                <td mat-cell *matCellDef="let row" [matTooltip]="getTooltip(row,'Risk')">{{row.Risk}}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="ScheduleInherentRiskStatus">
                                <th mat-header-cell *matHeaderCellDef>Status</th>
                                <td mat-cell *matCellDef="let row"
                                    [matTooltip]="getTooltip(row,'ScheduleInherentRiskStatusName')">
                                    {{row.ScheduleInherentRiskStatusName}}</td>
                            </ng-container>
                            <ng-container matColumnDef="OverallInherentRiskRating">
                                <th mat-header-cell *matHeaderCellDef [hidden]="showInherentRiskStatus">Inherent
                                    Risk Rating</th>
                                <td mat-cell *matCellDef="let row" 
                                    [style.background]="row.OverallInherentRiskColor || '#eee'"
                                    [style.color]="getContrastColor(row.OverallInherentRiskColor || '#eee')"
                                    [matTooltip]="getTooltip(row,'OverallInherentRiskRating')"
                                    [hidden]="showInherentRiskStatus">
                                    {{row.OverallInherentRiskRating}}</td>
                            </ng-container>
                            <ng-container matColumnDef="OverallControlEnvironment">
                                <th mat-header-cell *matHeaderCellDef>Control Environment</th>
                                <td mat-cell *matCellDef="let row"
                                    [style.background]="row.OverallControlEnvironmentRatingColourCode || '#eee'"
                                    [style.color]="getContrastColor(row.OverallControlEnvironmentRatingColourCode || '#eee')"
                                    [matTooltip]="getTooltip(row,'OverallControlEnvironmentRiskRating')">
                                    {{row.OverallControlEnvironmentRiskRating}}</td>
                            </ng-container>
                            <ng-container matColumnDef="ResidualRiskRating">
                                <th mat-header-cell *matHeaderCellDef="let row">
                                    Residual Risk Rating
                                </th>
                                <td mat-cell *matCellDef="let row"
                                    [style.background]="row.ResidualRiskRatingColourCode || '#eee'"
                                    [style.color]="getContrastColor(row.ResidualRiskRatingColourCode || '#eee')"
                                    [matTooltip]="getTooltip(row,'ResidualRiskRating')">
                                    {{ row.ResidualRiskRating }}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="Comments">
                                <th mat-header-cell *matHeaderCellDef [hidden]="showActionPlanCommentStatus">Self
                                    Comments
                                </th>
                                <td mat-cell *matCellDef="let row" [matTooltip]="getTooltip(row,'SelfComment')"
                                    [hidden]="showActionPlanStatus">
                                    {{row.SelfComment}}</td>
                            </ng-container>
                            <ng-container matColumnDef="ActionPlanRequired">
                                <th mat-header-cell *matHeaderCellDef>Action Plan Required</th>
                                <td mat-cell *matCellDef="let row"
                                    [matTooltip]="row.IsActionPlanRequired == null ? '' : row.IsActionPlanRequired == 1 ? 'Yes' : 'No'">
                                    {{ row.IsActionPlanRequired == null ? '' : row.IsActionPlanRequired == 1 ? 'Yes' :
                                    'No' }}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="TotalActionPlans">
                                <th mat-header-cell *matHeaderCellDef>Total Action Plans</th>
                                <td mat-cell *matCellDef="let row" [matTooltip]="row.TotalActionPlans">
                                    {{ row.TotalActionPlans }}
                                </td>
                            </ng-container>
                            <tr mat-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row;  columns: displayedColumns;" style="cursor: pointer;"
                                (dblclick)="navigateDetails(row)"></tr>
                        </table>
                        <mat-paginator [pageSize]="10" [pageSizeOptions]="[10, 25, 100]"
                            class="InherentTable"></mat-paginator>
                    </mat-card-content>
                    <mat-card-actions>
                        <div fxFlex="row" fxLayoutAlign="center center" *ngIf="datanotFound">
                            <span class="Errorinfo">{{datanotFound}} </span>
                        </div>
                        <div
                            style="align-items: center;  display: flex; align-content: space-between;justify-content: space-around;">
                        </div>
                    </mat-card-actions>
                </mat-card>
            </div>
        </div>
    </mat-action-row>
</div>