<mat-toolbar class="fontSize">
    <span>Inherent Risk</span>
    <span class="spacer"></span>
</mat-toolbar>

<mat-action-row style="padding-bottom: 0px;padding-top: 20px;">

    <span *ngIf="canFullAccess()">

        <div class="btnGenUp ev" style="margin-bottom: 3vh;">
            <img src="./assets/images/icon-upload.svg" class="mx-2" alt="" matTooltip="Browse" />
            <input type="file" class="file-upload" id="file-input" name="file-input" ng2FileSelect [uploader]="uploader"
                (change)="seletedFileDetails($event)" />
            <label id="file-input-label" for="file-input">Browse File</label>
        </div>
    </span>
    <div class="btnGen ev me-4" data-toggle="modal" style="position: absolute;left: 22vh;margin-bottom: 3vh;"
        [ngClass]="(!importButtonFlag) ? 'disable'  : 'enable'"
        [matTooltip]="!importButtonFlag ? ' Select a valid file before importing list' : 'Import list in bulk'"
        (click)="bulkUploadExcelFile()" *ngIf="canFullAccess()"><img src="./assets/images/icon-import.svg"
            alt="Import List in Bulk">Bulk Upload</div>
    <div class="btnGenDown ev me-4" style="border: hidden; cursor: pointer;margin-left: 18vh;margin-bottom: 3vh;"
        (click)="downloadSampleFile()" id="download" data-target="#addWidget"
        matTooltip="Download Sample Bulk Upload Template" *ngIf="canFullAccess()"><img
            src="./assets/images/icon-download-template.svg" style="vertical-align: text-bottom;
        width: 1.2em;
        margin-right: 1vh;
        margin-left: 1vh;
        margin-top: 0.5vh;" alt="Download"> <span>Download Template</span> </div>
    <span class="spacer"></span>
    <div class="assesment-button dflexB ui-g-4">
        <mat-form-field appearance="fill">
            <mat-label>Search</mat-label>
            <input #txtSearch matInput placeholder="Eg. FR" (keyup)="applyFilter($event)">
        </mat-form-field>
        <div class="applyFilter addDesktop position-relative text-start me-4" *ngIf="canFullAccess()">
            <button type="button" class="btn btn-dark btnGradient ad" data-bs-toggle="modal"
                matTooltip="Create Inherent Risk" (click)="initiateAdd()"><span class="font-weight-bold"></span>Create
                Risk</button>
            <span class="position-absolute vmiddleLeft text-white iconPositionLeft"><img
                    src="./assets/images/icon-add-desktop.svg" style="    width: 2vh;
                margin-top: 1vh;" [ngStyle]="{'margin-left': showexportData ? '-7.3vh' : '-2.1vh'}"></span>
        </div>
        <span *ngIf="showexportData && canFullAccess()" (click)="exportAsXLSX()" class="mat-button-wrapper"
            matTooltip="Export to Excel"><img src="assets/icon-excel.svg" style="opacity:Â 1;"></span>
    </div>
</mat-action-row>

<!-- Filter Row -->
<div class="filter-row">
    <mat-form-field appearance="standard" class="list-filter-field">
        <mat-label>Department</mat-label>
        <mat-select matSelectSearch placeholder="Search department..." [multiple]="true"
            [(ngModel)]="listFilterDepartmentIds"
            (selectionChange)="onListDepartmentChange()">
            <mat-option *ngFor="let dept of listDepartments" [value]="dept.GroupID">
                {{ dept.Name }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="standard" class="list-filter-field">
        <mat-label>Unit</mat-label>
        <mat-select matSelectSearch placeholder="Search unit..." [multiple]="true"
            [(ngModel)]="listFilterUnitIds"
            [disabled]="listFilterDepartmentIds.length === 0"
            (selectionChange)="onListUnitChange()">
            <mat-option *ngFor="let unit of listFilteredUnits" [value]="unit.UnitID">
                {{ unit.Name }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="standard" class="list-filter-field">
        <mat-label>Process</mat-label>
        <mat-select matSelectSearch placeholder="Search process..." [multiple]="true"
            [(ngModel)]="listFilterProcessIds"
            (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let proc of listProcesses" [value]="proc.ProcessID">
                {{ proc.ProcessName }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="standard" class="list-filter-field">
        <mat-label>Risk Category</mat-label>
        <mat-select matSelectSearch placeholder="Search risk category..." [multiple]="true"
            [(ngModel)]="listFilterRiskCategoryIds"
            (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let rc of listRiskCategories" [value]="rc.RiskCategoryID">
                {{ rc.RiskCategoryName }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="standard" class="list-filter-field">
        <mat-label>Likelihood Rating</mat-label>
        <mat-select matSelectSearch placeholder="Search likelihood..." [multiple]="true"
            [(ngModel)]="listFilterLikelihoodNames"
            (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let lr of listLikelihoodRatings" [value]="lr.Name">
                {{ lr.Name }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="standard" class="list-filter-field">
        <mat-label>Impact Rating</mat-label>
        <mat-select matSelectSearch placeholder="Search impact..." [multiple]="true"
            [(ngModel)]="listFilterImpactNames"
            (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let ir of listImpactRatings" [value]="ir.Name">
                {{ ir.Name }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="standard" class="list-filter-field">
        <mat-label>Overall Risk Rating</mat-label>
        <mat-select matSelectSearch placeholder="Search overall risk..." [multiple]="true"
            [(ngModel)]="listFilterOverallRiskNames"
            (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let orr of listOverallRiskRatings" [value]="orr.Name">
                {{ orr.Name }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <button mat-stroked-button class="clear-filters-btn" (click)="clearAllFilters()"
        matTooltip="Clear all filters"
        [disabled]="!hasActiveFilters()">
        <mat-icon>filter_list_off</mat-icon> Clear
    </button>
</div>

<div *ngIf="filenameWithoutExtension.length > 0 && invalidfile == false && validFileNameErr == false"
    style="position: relative; left: 29px; bottom: 13px; display: inline-flex;">
    <p style="color: seagreen; margin: 0px;">{{fileName}}</p>
</div>
<mat-action-row style="padding: 0px; position: relative; bottom: 8px;">
    <mat-card class="mat-elevation-z4" style="width: 100%;">
        <mat-card-header>

        </mat-card-header>

        <mat-card-content>

            <table id="InherentTable" mat-table [dataSource]="dataSource" matSort>
                <ng-container matColumnDef="RowNumber">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>#</th>
                    <td mat-cell *matCellDef="let row"> {{row.RowNumber}} </td>
                </ng-container>
                <ng-container matColumnDef="SLNO">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>SLNO</th>
                    <td mat-cell *matCellDef="let row"> {{row.SLNO}} </td>
                </ng-container>
                <mat-divider [vertical]="true"></mat-divider>
                <ng-container matColumnDef="Group">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Department</th>
                    <td mat-cell *matCellDef="let row" [matTooltip]="row.GroupName"> {{row.GroupName}} </td>
                </ng-container>
                <ng-container matColumnDef="Unit">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Unit</th>
                    <td mat-cell *matCellDef="let row" [matTooltip]="row.UnitName"> {{row.UnitName}} </td>
                </ng-container>
                <ng-container matColumnDef="Process">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Process</th>
                    <td mat-cell *matCellDef="let row" [matTooltip]="row.ProcessName"> {{row.ProcessName}} </td>
                </ng-container>
                <ng-container matColumnDef="RiskCategory">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Risk Category</th>
                    <td mat-cell *matCellDef="let row" [matTooltip]="row.RiskCategoryName"> {{row.RiskCategoryName}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="CorporateObjectiveName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Corporate Objective</th>
                    <td mat-cell *matCellDef="let row" [matTooltip]="row.CorporateObjectiveName">
                        {{row.CorporateObjectiveName}} </td>
                </ng-container>
                <ng-container matColumnDef="Risk">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Risk</th>
                    <td mat-cell *matCellDef="let row" [matTooltip]="row.Risk"> {{row.Risk}} </td>
                </ng-container>
                <ng-container matColumnDef="InherentLikelihood">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Likelihood Rating</th>
                    <td mat-cell *matCellDef="let row"> {{row.InherentLikelihoodName}} </td>
                </ng-container>
                <ng-container matColumnDef="OverallInherentName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Overall Risk Rating</th>
                    <td mat-cell *matCellDef="let row" [style.background]="row.OverallInherentRiskColor || '#eee'"
                        [style.color]="getContrastColor(row.OverallInherentRiskColor || '#eee')">
                        {{ row.OverallInherentName }}
                    </td>
                </ng-container>
                <ng-container matColumnDef="InherentImpactRating">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Impact Rating</th>
                    <td mat-cell *matCellDef="let row"> {{row.InherentImpactRatingName}} </td>
                </ng-container>
                <ng-container matColumnDef="OverallInherentRiskRating">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Overall Inherent Risk</th>
                    <td mat-cell *matCellDef="let row"> {{row.OverallInherentRisk}} </td>
                </ng-container>
                <ng-container matColumnDef="Action">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Action</th>
                    <td mat-cell *matCellDef="let row">
                        <button mat-icon-button [disabled]="!canFullAccess()">
                            <mat-icon (click)="editData(row)" aria-hidden="false" aria-label="Edit">edit
                            </mat-icon>
                        </button>
                    </td>
                </ng-container>
                <ng-container matColumnDef="Status">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header mat-column-StatusName>Status</th>
                    <td mat-cell *matCellDef="let row; let i = index;">

                        <mat-slide-toggle [checked]="row.IsActive"
                            [disabled]="i === 0 && disableToggle === 1 || !canFullAccess()" (change)="changed(row)">
                        </mat-slide-toggle>

                        <span *ngIf="row.IsActive">Enabled</span>
                        <span *ngIf="!row.IsActive">Disabled</span>
                        &nbsp;&nbsp;
                        <span style="position: absolute;top: 12vh;">
                            <img src="./assets/colorkit-black.svg" class="headingIcon prs" alt="toogle"
                                style="width:1.3vw;" *ngIf="i === 0 && disableToggle === 1"
                                [matTooltip]="'There should be at least one Active inherent risk to disable this record.'">
                        </span>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>

            <mat-paginator [pageSizeOptions]="[10, 25, 100]" class="InherentTable"></mat-paginator>
        </mat-card-content>

        <mat-error *ngIf="saveerror">{{saveerror}}</mat-error>
        <mat-card-actions>

        </mat-card-actions>
    </mat-card>
</mat-action-row>